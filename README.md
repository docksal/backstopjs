# BackstopJS Docker Image

A self-contained Docker image to run [BackstopJS](https://github.com/garris/BackstopJS) with no external dependencies.

[Visual Regression Testing with BackstopJS in a Docker container](https://blog.docksal.io/visual-regression-testing-with-backstopjs-in-a-docker-container-dfd1b9ae8582)

Features:

- [BackstopJS 3.x](https://github.com/garris/BackstopJS)
- [PhantomJS](http://phantomjs.org/)
- [SlimerJS](https://slimerjs.org/) (with Firefox ESR)
- [CasperJS](http://casperjs.org/)
- Chromium


## Versions

- `docksal/backstopjs:2` - BackstopJS 2.x (legacy)
- `docksal/backstopjs` (`docksal/backstopjs:3`) - BackstopJS 3 with Chrome Headless support


## Usage

Use this image as if you were using a binary.  
Working directory is expected to be mounted at `/src` in the container.

```
$ docker run --rm -v $(pwd):/src docksal/backstopjs --version
BackstopJS v3.0.25
```

You can also add a shell alias (in `.bashrc`, `.zshrc`, etc.) for convenience.

```
alias backstop='docker run --rm -v $(pwd):/src docksal/backstopjs "$@"'
```

Restart your shell or open a new one, then

```
$ backstopjs --version
BackstopJS v3.0.25
```


## Sample test

```
docker run --rm -v $(pwd):/src docksal/backstopjs init
docker run --rm -v $(pwd):/src docksal/backstopjs reference
docker run --rm -v $(pwd):/src docksal/backstopjs test
```


## Browser engines

By default BackstopJS is using Headless Chrome to take screenshots.

You can also use PhantomJS or SlimerJS/Firefox by setting `"engine": "phantomjs"` or `"engine": "slimerjs"` respectively 
in `backstop.json`.

Chrome, PhantomJS, SlimerJS and Firefox ESR (extended support release) are pre-installed in the container.


## Limitations

`backstop openReport` is not (yet) supported.  
You will need a running webserver to view HTML reports generated by BackstopJS.

When running SlimerJS, the user you are running the container as must have a home directory in order for Slimer 
to start properly. You can work around this by setting the `HOME` variable:

```
docker run --rm --user 1000 -e HOME=/tmp/home docksal/backstopjs test
```


## Debugging

The following command will start a bash session in the container.

```
docker run --rm -v $(pwd):/src -it --entrypoint=bash docksal/backstopjs
```
