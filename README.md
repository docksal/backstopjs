# BackstopJS Docker Image

A self-contained Docker image to run [BackstopJS](https://github.com/garris/BackstopJS) with no external dependencies.

Features:

- [BackstopJS 2.x](https://github.com/garris/BackstopJS)
- [PhantomJS](http://phantomjs.org/), 
- [SlimerJS](https://slimerjs.org/) (with Firefox ESR), 
- [CasperJS](http://casperjs.org/)


## Usage

Use this image as if you were using a binary.  
Working directory is expected to be mounted at `/src` in the container.

```
$ docker run --rm -v $(pwd):/src docksal/backstopjs --version
BackstopJS 2.0.2
```

You can also add a shell alias (in `.bashrc`, `.zshrc`, etc.) for convenience.

```
alias backstop='docker run --rm -v $(pwd):/src docksal/backstopjs "$@"'
```

Restart your shell or open a new one, then

```
$ backstopjs --version
BackstopJS 2.0.2
```


## Sample test

```
docker run --rm -v $(pwd):/src docksal/backstopjs genConfig
docker run --rm -v $(pwd):/src docksal/backstopjs reference
docker run --rm -v $(pwd):/src docksal/backstopjs test
```


## PhantomJS/SlimerJS

By default BackstopJS is using PhantomJS to take screenshots.  
You can also use SlimerJS/Firefox by setting `"engine": "slimerjs"` 
in the [configuration file](tests/backstop/backstop-example.json).

Both SlimerJS and Firefox ESR (extended support release) are installed in the container.


## Limitations

`backstop openReport` is not (yet) supported.  
You will need a running webserver to view HTML reports generated by BackstopJS.

When running SlimerJS, the user you are running the container as must have a home directory in order for Slimer to start properly.  You can work around this by setting the HOME variable.  Ex:
```
docker run --rm --user 1000 -e HOME=/tmp/home docksal/backstopjs test
```

## Debugging

The following command will start a bash session in the container.

```
docker run --rm -v $(pwd):/src -it --entrypoint=bash docksal/backstopjs
```
